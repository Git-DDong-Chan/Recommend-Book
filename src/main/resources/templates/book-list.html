<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Book List</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<style>
    .recommendation-btn {
        transition: background-color 0.3s ease-in-out;
    }

    .read {
        background-color: green;
    }

    .not-read {
        background-color: red;
    }

    /* Remove the button border */
    .btn {
        border: none;
    }
    .read:hover{
        background-color: red;
    }
    .not-read:hover{
        background-color: green;
    }

    /* Display comment input when toggled to 'Read' */
    .comment-input {
        display: none;
    }
    .read + .comment-input {
        display: block;
    }
</style>

<body>
    <div class="container mt-5">
        <h1 class="mb-4">Book List</h1>
        <table class="table table-striped">
            <thead>
                <tr style="text-align: center;">
                    <th>Num</th>
                    <th>Title</th>
                    <th>Author</th>
                    <th>Comments</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
                <tr style="text-align: center;" th:each="book : ${books}">
                    <td th:text="${book.num}"></td>
                    <td th:text="${book.title}"></td>
                    <td th:text="${book.author}"></td>
                    <td th:text="${book.Comment}"></td>
                    <td>
                        <button class="btn btn-primary toggle-btn recommendation-btn"
                                th:classappend="${book.count == 1} ? 'read' : 'not-read'"
                                th:attr="data-book-id=${book.num}, data-count=${book.count}">
                            <span th:if="${book.count == 1}">Read</span>
                            <span th:if="${book.count == 0}">Not Read</span>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const toggleButtons = document.querySelectorAll(".toggle-btn");

            toggleButtons.forEach(button => {
                button.addEventListener("click", function() {
                    const bookId = this.getAttribute("data-book-id");
                    const currentCount = parseInt(this.getAttribute("data-count"));
                    const buttonSpan = this.querySelector("span");

                    fetch(`/toggleRecommendation/${bookId}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                this.setAttribute("data-count", data.newCount);
                                buttonSpan.textContent = data.newCount === 1 ? "Read" : "Not Read";

                                // Update the button class based on the newCount
                                if (data.newCount === 1) {
                                    button.classList.add("read");
                                    button.classList.remove("not-read");
                                } else {
                                    button.classList.remove("read");
                                    button.classList.add("not-read");
                                }
                            } else {
                                console.error("Failed to toggle recommendation");
                            }
                        })
                        .catch(error => {
                            console.error("Error:", error);
                        });
                });
            });
        });
    </script>
</body>
</html>
