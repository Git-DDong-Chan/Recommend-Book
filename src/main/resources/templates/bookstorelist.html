
<html xmlns:th="http://www.thymeleaf.org" style="background-image: url('/images/wooden.png'); background-size: cover; background-position: center; height: 100%;"></html>
<link rel="stylesheet" type="text/css" th:href="@{/bootstrap.min.css}" />
<link rel="stylesheet" type="text/css" th:href="@{/styles.css}" />


  <a href="#" id="wishlistLink" th:text="${loggedInUsername}"></a><a>의 책꽂이</a>
  <input type="text" id="search_kw" class="form-control" th:value="${kw}" style="width: 50%;">
  <button class="btn btn-outline-secondary" type="button" id="btn_search">찾기</button>
  <td><textarea cols="40" rows="10" name="content" placeholder="내용을 입력하세요"></textarea></td>
<style>
 
</style>


  <div class="table-container">
    <div class="table-container">
      <table class="table">
        <tbody>
          <tr th:each="rowIndex : ${#numbers.sequence(0,2)}">
            
              <div class="d-flex">
                <div
                  class="test_obj"
                  th:each="colIndex : ${#numbers.sequence(0,3)}"
                  th:if="${#lists.size(paging.content) > rowIndex * 4 + colIndex}"
                  th:text="${paging.content[rowIndex * 4 + colIndex].bookname}"
                  th:date="${paging.content[rowIndex * 4 + colIndex].bookdate}"
                  th:content="${paging.content[rowIndex * 4 + colIndex].bookcontent}"
                ></div>
              </div>
            
          </tr>
        </tbody>
      </table>
    </div>

  <div th:if="${!paging.isEmpty()}">
    <ul class="pagination justify-content-center">
        <li class="page-item" th:classappend="${!paging.hasPrevious} ? 'disabled'">
            <a class="page-link" href="javascript:void(0)" th:data-page="${paging.number-1}">
                <span>이전</span>
            </a>
        </li>
        <li th:each="page: ${#numbers.sequence(0, paging.totalPages-1)}"
            th:if="${page >= paging.number-5 and page <= paging.number+5}"
            th:classappend="${page == paging.number} ? 'active'" 
            class="page-item">
            <a th:text="${page}" class="page-link" href="javascript:void(0)" th:data-page="${page}"></a>
        </li>
        <li class="page-item" th:classappend="${!paging.hasNext} ? 'disabled'">
            <a class="page-link" href="javascript:void(0)" th:data-page="${paging.number+1}">
                <span>다음</span>
            </a>
        </li>
    </ul>
  </div>
  <!-- 페이징처리 끝 -->
  <form th:action="@{/bookstore/list}" method="get" id="searchForm">
    <input type="hidden" id="kw" name="kw" th:value="${kw}">
    <input type="hidden" id="page" name="page" th:value="${paging.number}">
  </form>
  </div>
  </div>
  
</div>
  

<script layout:fragment="script" type='text/javascript'>
    const page_elements = document.getElementsByClassName("page-link");
    Array.from(page_elements).forEach(function(element) {
        element.addEventListener('click', function() {
            document.getElementById('page').value = this.dataset.page;
            document.getElementById('searchForm').submit();
        });
    });
    const btn_search = document.getElementById("btn_search");
    btn_search.addEventListener('click', function() {
        document.getElementById('kw').value = document.getElementById('search_kw').value;
        document.getElementById('page').value = 0;  // 검색버튼을 클릭할 경우 0페이지부터 조회한다.
        document.getElementById('searchForm').submit();
    });
</script>
<script>
  document.getElementById("wishlistLink").addEventListener("click", function(event) {
      event.preventDefault(); // 이벤트의 기본 동작인 링크 이동을 막습니다.
      window.location.href = "http://localhost:8080/bookstore/list?kw=&page=0"; // 원하는 URL로 이동합니다.
  });
</script>




<div class="modal fade" id="bookModal" tabindex="-1" role="dialog" aria-labelledby="bookModalLabel">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
   

      <div class="modal-body" style="height: 500px; background-image: url('/images/book1.png'); background-size: cover; background-position: center; display: flex;">
        <div style="flex: 1; margin-left: -70px;">
        </div>
        <div style="flex: 2; margin-top: 50px;">
          <p id="bookModalText" ></p>
          <small id="bookModalDate"></small>
          <br><br>
            <p id="bookModalContent"></p>
        </div>
        <div style="flex: 2; margin-top: 100px; ">
          <p id="remainingContent"></p>
        </div>
    </div>
    
    </div>
  </div>
</div>



<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
 $(document).ready(function () {
    function formatText(text, maxLength) {
        var result = '';
        for (var i = 0; i < text.length; i += maxLength) {
            result += text.substring(i, i + (i === 0 ? maxLength : maxLength + 4)); // Use maxLength or maxLength - 4
            if (i + maxLength < text.length) {
                result += "<br>";
                
            }
        }
        return result;
    }

    $(".test_obj").click(function () {
        var bookName = $(this).text();
        var bookDate = $(this).attr("date");
        var bookContent = $(this).attr("content");
        var formattedBookContent = formatText(bookContent, 18);

        $("#bookModalText").text(" 책 제목: " +bookName);
        $("#bookModalDate").text("작성일시: " + bookDate);
        
        const contentText = formattedBookContent;
        if (contentText.length > 100) {
            const truncatedText = contentText.substring(0, 200);
            $("#bookModalContent").html("책내용: " + truncatedText);
            $("#remainingContent").html(contentText.substring(200)); // Use .html() here
        } else {
            $("#bookModalContent").html("책내용:" + contentText);
            $("#remainingContent").text("");
        }

        // Additional code to fetch and display other book details if needed
        $("#bookModal").modal("show");
    });
});




</script>


